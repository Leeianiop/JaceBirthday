<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Birthday Game</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
<style>
  body {
    background: #ffffff; 
    margin: 0;
    font-family: 'Pacifico', cursive;
    display: flex;
    align-items: center;
    flex-direction: column;
    min-height: 100vh;
    overflow: hidden;
  }
  #birthdayText {
    font-size: 28px;
    cursor: pointer;
    margin-top: 20px;
    z-index: 2;
  }
  #countdown { font-size: 22px; margin-top: 10px; z-index: 2; }
  #confetti {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }
  #gameCanvas {
    background: #ffffff; 
    margin-top: 20px;
    border-radius: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 1;
  }
</style>
</head>
<body>

<canvas id="confetti"></canvas>
<div id="birthdayText">Happy 46th Birthday Daddy</div>
<div id="countdown"></div>
<canvas id="gameCanvas" width="1200" height="600"></canvas>

<script>
/* ========= Setup ========= */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

/* Text cycle */
const texts = [
  "Happy 46th Birthday Daddy",
  "Happy 46th Birthday Jace",
  "Happy 46th Birthday Lee",
  "Hapi Bday Mah N-"
];
let textIndex = 0;
document.getElementById('birthdayText').addEventListener('click', () => {
  textIndex = (textIndex + 1) % texts.length;
  document.getElementById('birthdayText').innerText = texts[textIndex];
});

/* Countdown target */
function getNextCountdown() {
  const now = new Date();
  let target = new Date(now.getFullYear(), 7, 13);
  if (now > target) target.setFullYear(now.getFullYear() + 1);
  return target;
}
let targetDate = getNextCountdown();

/* Keys */
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup',   e => keys[e.key.toLowerCase()] = false);

/* Images */
const cakeFrames = [new Image(), new Image()];
cakeFrames[0].src = 'cake normal.png';
cakeFrames[1].src = 'cake eaten.png';
const planeImg = new Image();
planeImg.src = 'plane.png';
const playerFrames = [new Image(), new Image()];
playerFrames[0].src = 'player1.png';
playerFrames[1].src = 'player2.png';
const momImg = new Image();
momImg.src = 'mom.png';

/* Game state */
let cake = { x: 800, y: 430, width: 200, height: 250, frame: 0, visible: true };
let player = { x: 200, y: 420, w: 120, h: 150, frame: 0 };
let npc = { x: 500, y: 400, w: 120, h: 150, visible: false };
let showPlane = false;
let dialogue = "";
let interactionStage = 0;

/* Countdown bar */
function drawCountdownBar() {
  const now = new Date();
  if (now >= targetDate) targetDate = getNextCountdown();
  const diff = targetDate - now;
  const total = targetDate - new Date(now.getFullYear(), 7, 12);
  const ratio = Math.max(0, diff / total);

  ctx.fillStyle = '#ccc';
  ctx.fillRect(200, 50, 800, 30);
  ctx.fillStyle = '#20c997';
  ctx.fillRect(200, 50, 800 * (1 - ratio), 30);

  ctx.fillStyle = 'black';
  ctx.font = '20px Pacifico';
  const days = Math.floor(diff / (1000*60*60*24));
  ctx.fillText(`${days} days until Aug 13`, 450, 95);
}

/* Draw cake */
function drawCake() {
  if (!cake.visible) return;
  const cf = cakeFrames[cake.frame];
  if (cf.complete) ctx.drawImage(cf, cake.x, cake.y, cake.width, cake.height);
  ctx.fillStyle = 'black';
  ctx.font = '20px Pacifico';
  ctx.fillText('(Press A to eat)', cake.x, cake.y - 10);
}

/* Draw player */
function drawPlayer() {
  const pf = playerFrames[player.frame];
  if (pf.complete) ctx.drawImage(pf, player.x, player.y, player.w, player.h);
}

/* Draw NPC */
function drawNPC() {
  if (!npc.visible) return;
  if (momImg.complete) ctx.drawImage(momImg, npc.x, npc.y, npc.w, npc.h);

  if (dialogue) {
    ctx.fillStyle = 'white';
    ctx.fillRect(npc.x - 30, npc.y - 60, 200, 40);
    ctx.strokeRect(npc.x - 30, npc.y - 60, 200, 40);
    ctx.fillStyle = 'black';
    ctx.font = '18px Pacifico';
    ctx.fillText(dialogue, npc.x - 20, npc.y - 35);
  }
}

/* Handle keys */
document.addEventListener('keydown', e => {
  if (e.key.toLowerCase() === 'a' && cake.visible) {
    cake.frame = 1;
    setTimeout(() => {
      cake.frame = 0;
      cake.visible = false;
      npc.visible = true;
      dialogue = "Hi!";
      interactionStage = 1;
    }, 500);
  }
  if (e.key === " " && npc.visible) {
    if (interactionStage === 1) {
      dialogue = "Hi back!";
      interactionStage = 2;
      setTimeout(() => {
        dialogue = "";
        npc.visible = false;
        showPlane = true;
      }, 1000);
    }
  }
});

/* Game loop */
function gameLoop() {
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  drawCountdownBar();
  drawPlayer();
  drawCake();
  drawNPC();

  if (showPlane && planeImg.complete) {
    ctx.drawImage(planeImg, 700, 200, 400, 300);
  }

  requestAnimationFrame(gameLoop);
}
gameLoop();

/* Confetti background */
const confetti = document.getElementById('confetti');
const cctx = confetti.getContext('2d');
function sizeConfetti() {
  confetti.width = window.innerWidth;
  confetti.height = window.innerHeight;
}
sizeConfetti();
window.addEventListener('resize', sizeConfetti);
const pieces = Array.from({ length: 150 }).map(() => ({
  x: Math.random() * confetti.width,
  y: Math.random() * confetti.height,
  s: Math.random() * 6 + 4,
  v: Math.random() * 2 + 1,
  c: `hsl(${Math.random()*360}, 100%, 50%)`,
  r: Math.random() * Math.PI
}));
function drawConfetti() {
  cctx.clearRect(0, 0, confetti.width, confetti.height);
  pieces.forEach(p => {
    cctx.save();
    cctx.translate(p.x, p.y);
    cctx.rotate(p.r);
    cctx.fillStyle = p.c;
    cctx.fillRect(-p.s/2, -p.s/2, p.s, p.s);
    cctx.restore();
    p.y += p.v;
    p.r += 0.02;
    if (p.y > confetti.height+20) {
      p.y = -20;
      p.x = Math.random() * confetti.width;
    }
  });
  requestAnimationFrame(drawConfetti);
}
drawConfetti();
</script>
</body>
</html>



