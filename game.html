<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Birthday Game</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
<style>
  :root { --card-w: 1200px; --card-h: 600px; }
  * { box-sizing: border-box; }
  body {
    background: #ffffff; 
    margin: 0;
    font-family: 'Pacifico', cursive;
    display: flex;
    align-items: center;
    flex-direction: column;
    min-height: 100vh;
    overflow: hidden; /* keep confetti tidy */
  }
  #birthdayText {
    font-size: 28px;
    cursor: pointer;
    margin-top: 20px;
    z-index: 2;
  }
  #countdown {
    font-size: 22px;
    margin-top: 10px;
    z-index: 2;
  }
  #confetti {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }
  #gameCanvas {
    background: #ffffff; 
    margin-top: 20px;
    border-radius: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 1;
  }
</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div id="birthdayText">Happy 46th Birthday Daddy</div>
<div id="countdown"></div>
<canvas id="gameCanvas" width="1200" height="600"></canvas>

<script>
/* ========= Setup ========= */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

/* Cycle text */
const texts = [
  "Happy 46th Birthday Daddy",
  "Happy 46th Birthday Jace",
  "Happy 46th Birthday Lee",
  "Hapi Bday Mah N-"
];
let textIndex = 0;
document.getElementById('birthdayText').addEventListener('click', () => {
  textIndex = (textIndex + 1) % texts.length;
  document.getElementById('birthdayText').innerText = texts[textIndex];
});

/* Countdown target */
function getNextCountdown() {
  const now = new Date();
  let target = new Date(now.getFullYear(), 7, 13); // August = month 7
  if (now > target) target.setFullYear(now.getFullYear() + 1);
  return target;
}
let targetDate = getNextCountdown();

/* Keys */
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup',   e => keys[e.key.toLowerCase()] = false);

/* Images */
const cakeFrames = [new Image(), new Image()];
cakeFrames[0].src = 'cake normal.png';
cakeFrames[1].src = 'cake eaten.png';
const specialImage = new Image();
specialImage.src = 'pixil-frame-0 (1).png';

/* Game state */
let cake = { x: 800, y: 430, width: 200, height: 250, frame: 0 };
let eatCount = 0;
let showSpecial = false;

/* Draw helpers */
function drawRoundedRect(x, y, w, h, r, fillStyle) {
  ctx.fillStyle = fillStyle;
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  ctx.fill();
}

/* Countdown bar (blue-green fill) */
function drawCountdownBar() {
  const now = new Date();
  if (now >= targetDate) targetDate = getNextCountdown();
  const diff = targetDate - now;
  const total = targetDate - new Date(now.getFullYear(), 7, 13 - 1); // from last Aug 13
  const ratio = Math.max(0, diff / total);

  const barX = 200, barY = 50, barW = 800, barH = 30, radius = 15;
  drawRoundedRect(barX, barY, barW, barH, radius, '#ccc'); // background
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(barX + radius, barY);
  ctx.lineTo(barX + barW - radius, barY);
  ctx.quadraticCurveTo(barX + barW, barY, barX + barW, barY + radius);
  ctx.lineTo(barX + barW, barY + barH - radius);
  ctx.quadraticCurveTo(barX + barW, barY + barH, barX + barW - radius, barY + barH);
  ctx.lineTo(barX + radius, barY + barH);
  ctx.quadraticCurveTo(barX, barY + barH, barX, barY + barH - radius);
  ctx.lineTo(barX, barY + radius);
  ctx.quadraticCurveTo(barX, barY, barX + radius, barY);
  ctx.closePath();
  ctx.clip();

  ctx.fillStyle = '#20c997'; // blue-green
  ctx.fillRect(barX, barY, barW * (1 - ratio), barH);
  ctx.restore();

  ctx.fillStyle = 'black';
  ctx.font = '20px Pacifico';
  const days = Math.floor(diff / (1000*60*60*24));
  ctx.fillText(`${days} days until Aug 13`, barX + 280, barY + 55);
}

/* Draw cake */
function drawCake() {
  const cf = cakeFrames[cake.frame];
  if (cf.complete) ctx.drawImage(cf, cake.x, cake.y, cake.width, cake.height);
  else { ctx.fillStyle = 'pink'; ctx.fillRect(cake.x, cake.y, cake.width, cake.height); }
  ctx.fillStyle = 'black';
  ctx.font = '24px Pacifico';
  ctx.fillText('(Press A to eat)', cake.x + 20, cake.y + 15);
}

/* Key actions */
document.addEventListener('keydown', e => {
  if (e.key.toLowerCase() === 'a') {
    eatCount++;
    cake.frame = 1; // eaten
    setTimeout(() => cake.frame = 0, 500); // back after 0.5s
    if (eatCount >= 15) showSpecial = true;
  }
});

/* Game loop */
function gameLoop() {
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  drawCountdownBar();

  if (showSpecial && specialImage.complete) {
    ctx.drawImage(specialImage, 100, -130, 1000, 1000);
  } else {
    drawCake();
  }

  requestAnimationFrame(gameLoop);
}
gameLoop();

/* Confetti background */
const confetti = document.getElementById('confetti');
const cctx = confetti.getContext('2d');
function sizeConfetti() {
  confetti.width = window.innerWidth;
  confetti.height = window.innerHeight;
}
sizeConfetti();
window.addEventListener('resize', sizeConfetti);
const pieces = Array.from({ length: 150 }).map(() => ({
  x: Math.random() * confetti.width,
  y: Math.random() * confetti.height,
  s: Math.random() * 6 + 4,
  v: Math.random() * 2 + 1,
  c: `hsl(${Math.random()*360}, 100%, 50%)`,
  r: Math.random() * Math.PI
}));
function drawConfetti() {
  cctx.clearRect(0, 0, confetti.width, confetti.height);
  pieces.forEach(p => {
    cctx.save();
    cctx.translate(p.x, p.y);
    cctx.rotate(p.r);
    cctx.fillStyle = p.c;
    cctx.fillRect(-p.s/2, -p.s/2, p.s, p.s);
    cctx.restore();
    p.y += p.v;
    p.r += 0.02;
    if (p.y > confetti.height+20) {
      p.y = -20;
      p.x = Math.random() * confetti.width;
    }
  });
  requestAnimationFrame(drawConfetti);
}
drawConfetti();
</script>
</body>
</html>

